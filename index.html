<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NRCC Messages</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@600&display=swap" rel="stylesheet">
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('https://raw.githubusercontent.com/MichaelH12345/fonts/main/Info1.png');
            background-size: cover;
            background-position: center;
        }
        .message-box {
            position: absolute;
            font-family: 'Noto Sans', sans-serif;
            color: white;
            font-size: 125px;
            width: 3000px;
            padding: 20px;
            text-align: center;
            overflow: hidden;
            cursor: pointer;
            top: 50%;
            right: 0;
            transform: translate(50.25%, -50%);
        }

        .station-box {
            position: absolute;
            font-family: 'Noto Sans', sans-serif;
            color: white;
            font-size: 75px;
            width: 3000px;
            padding: 20px;
            text-align: center;
            overflow: hidden;
            cursor: pointer;
            top: 5%;
            right: 0%;
            transform: translateX(50.25%);
        }

       .time-box {
            position: absolute;
            font-family: 'Noto Sans', sans-serif;
            color: white;
            font-size: 75px;
            padding: 20px;
            text-align: center;
            cursor: default;
            bottom: 75px; /* 50 pixels from the bottom */
            left: 100px; /* 50 pixels from the right */
        }
        }
    </style>
</head>
<body>
    <div class="station-box" id="stationName">
        CAR Station Notices
    </div>
    <div class="message-box" id="nrccMessages">
        Click to edit NRCC messages
    </div>
    <div class="time-box" id="messageCount"></div>

    <script>
        let currentStationCode = 'EDB'; // Default station code is always 'CAR'
        const fallbackMessages = [
            "Please do not leave luggage or belongings unattended anywhere on this station. Any unattended articles are likely to be removed or destroyed without warning.",
            "If you see something that looks unusual, speak to station staff or text the British Transport Police on 61016. We'll sort it. See it. Say it. Sorted."
        ];
        let currentFallbackIndex = 0;
        let fallbackInterval;

        // Function to update the NRCC messages
        async function fetchNRCCMessages() {
            try {
                const response = await fetch(`https://national-rail-api.davwheat.dev/staffdepartures/${currentStationCode}?expand=true`);
                const data = await response.json();
                
                let stationName = data.locationName;
                stationName = stationName.replace(/[\(\)]/g, ''); // Remove brackets
                document.getElementById('stationName').innerText = `${stationName} Station Notices`;
                
                let nrccMessages = data.nrccMessages;
                const messageBox = document.getElementById('nrccMessages');
                const messageCountBox = document.getElementById('messageCount');
                
                if (nrccMessages.length > 0) {
                    clearInterval(fallbackInterval);
                    let currentIndex = 0;
                    let message = nrccMessages[currentIndex].xhtmlMessage;
                    const moreDetailsIndex = message.indexOf('More details');
                    if (moreDetailsIndex !== -1) {
                        message = message.substring(0, moreDetailsIndex) + '';
                    }
                    
                    messageBox.innerHTML = message;
                    updateMessageCount(1, nrccMessages.length);

                    if (nrccMessages.length > 1) {
                        setInterval(() => {
                            currentIndex = (currentIndex + 1) % nrccMessages.length;
                            let message = nrccMessages[currentIndex].xhtmlMessage;
                            const moreDetailsIndex = message.indexOf('More details');
                            if (moreDetailsIndex !== -1) {
                                message = message.substring(0, moreDetailsIndex) + '';
                            }
                            
                            messageBox.innerHTML = message;
                            updateMessageCount(currentIndex + 1, nrccMessages.length);
                        }, 15000); // 15000 milliseconds = 15 seconds
                    }
                } else {
                    cycleFallbackMessages();
                }
            } catch (error) {
                cycleFallbackMessages();
            }
        }

        function updateMessageCount(currentPage, totalPages) {
            const messageCountBox = document.getElementById('messageCount');
            messageCountBox.innerText = `Page ${currentPage} of ${totalPages}`;
        }

        // Function to cycle through fallback messages every 15 seconds
        function cycleFallbackMessages() {
            const messageBox = document.getElementById('nrccMessages');
            messageBox.innerHTML = fallbackMessages[currentFallbackIndex];
            fallbackInterval = setInterval(() => {
                currentFallbackIndex = (currentFallbackIndex + 1) % fallbackMessages.length;
                messageBox.innerHTML = fallbackMessages[currentFallbackIndex];
            }, 15000);
        }

        // Initial fetch of NRCC messages when the page loads
        fetchNRCCMessages();
    </script>
</body>
</html>
